<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>
<?import javafx.geometry.Insets?>

<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="kirjanpito.ui.javafx.MainController"
            prefWidth="1200" prefHeight="750"
            style="-fx-background-color: #f8f9fa;">
    
    <!-- Menu Bar -->
    <top>
        <VBox>
            <MenuBar fx:id="menuBar" useSystemMenuBar="true">
                <!-- Tiedosto -->
                <Menu text="Tiedosto">
                    <MenuItem text="Uusi..." fx:id="newDatabaseItem" onAction="#handleNewDatabase" accelerator="Ctrl+U"/>
                    <MenuItem text="Avaa..." fx:id="openDatabaseItem" onAction="#handleOpenDatabase" accelerator="Ctrl+O"/>
                    <SeparatorMenuItem/>
                    <Menu text="ViimeisimmÃ¤t" fx:id="recentDatabasesMenu"/>
                    <MenuItem text="Palauta varmuuskopiosta..." onAction="#handleRestoreBackup"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Lopeta" onAction="#handleQuit" accelerator="Ctrl+Q"/>
                </Menu>
                
                <!-- Muokkaa -->
                <Menu text="Muokkaa">
                    <MenuItem text="Kopioi" fx:id="copyItem" onAction="#handleCopy" accelerator="Ctrl+C"/>
                    <MenuItem text="LiitÃ¤" fx:id="pasteItem" onAction="#handlePaste" accelerator="Ctrl+V"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Uusi tosite" onAction="#handleNewDocument" accelerator="Ctrl+N"/>
                    <MenuItem text="Poista tosite" onAction="#handleDeleteDocument" accelerator="Ctrl+Delete"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="LisÃ¤Ã¤ vienti" fx:id="addEntryItem" onAction="#handleAddEntry" accelerator="F8"/>
                    <MenuItem text="Poista vienti" fx:id="removeEntryItem" onAction="#handleRemoveEntry" accelerator="Shift+Delete"/>
                    <Menu fx:id="entryTemplateMenu" text="Vientimallit">
                        <!-- Templates populated dynamically -->
                        <SeparatorMenuItem/>
                        <MenuItem text="Muokkaa..." onAction="#handleEditEntryTemplates" accelerator="Ctrl+M"/>
                        <MenuItem text="Luo tositteesta..." onAction="#handleCreateEntryTemplate" accelerator="Ctrl+K"/>
                    </Menu>
                    <SeparatorMenuItem/>
                    <MenuItem text="Tilikartta..." onAction="#handleChartOfAccounts" accelerator="Ctrl+T"/>
                    <MenuItem text="Alkusaldot..." onAction="#handleStartingBalances" accelerator="Ctrl+B"/>
                    <MenuItem text="Perustiedot..." onAction="#handlePeriodSettings" accelerator="Ctrl+Shift+P"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="ALV-merkintÃ¤" onAction="#handleVatDocument" accelerator="Ctrl+Shift+V"/>
                </Menu>
                
                <!-- Siirry -->
                <Menu text="Siirry">
                    <MenuItem text="Edellinen" fx:id="prevDocItem" onAction="#handlePrevDocument" accelerator="Page_Up"/>
                    <MenuItem text="Seuraava" fx:id="nextDocItem" onAction="#handleNextDocument" accelerator="Page_Down"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="EnsimmÃ¤inen" fx:id="firstDocItem" onAction="#handleFirstDocument" accelerator="Ctrl+Page_Up"/>
                    <MenuItem text="Viimeinen" fx:id="lastDocItem" onAction="#handleLastDocument" accelerator="Ctrl+Page_Down"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Hae numerolla..." fx:id="gotoDocItem" onAction="#handleGotoDocument" accelerator="Ctrl+G"/>
                    <CheckMenuItem text="Etsi..." fx:id="searchMenuItem" onAction="#handleToggleSearch" accelerator="Ctrl+F"/>
                </Menu>
                
                <!-- Tositelaji -->
                <Menu text="Tositelaji" fx:id="docTypeMenu">
                    <!-- Tositelajit lisÃ¤tÃ¤Ã¤n dynaamisesti -->
                </Menu>
                
                <!-- Tulosteet -->
                <Menu text="Tulosteet">
                    <MenuItem text="Tilien saldot" onAction="#handleAccountSummary" accelerator="Ctrl+1"/>
                    <MenuItem text="Tosite" onAction="#handlePrintDocument" accelerator="Ctrl+2"/>
                    <MenuItem text="Tiliote" onAction="#handleAccountStatement" accelerator="Ctrl+3"/>
                    <MenuItem text="Tuloslaskelma" onAction="#handleIncomeStatement" accelerator="Ctrl+4"/>
                    <MenuItem text="Tuloslaskelma erittelyin" onAction="#handleIncomeStatementDetailed" accelerator="Ctrl+5"/>
                    <MenuItem text="Tase" onAction="#handleBalanceSheet" accelerator="Ctrl+6"/>
                    <MenuItem text="Tase erittelyin" onAction="#handleBalanceSheetDetailed" accelerator="Ctrl+7"/>
                    <MenuItem text="PÃ¤ivÃ¤kirja" onAction="#handleJournalReport" accelerator="Ctrl+8"/>
                    <MenuItem text="PÃ¤Ã¤kirja" onAction="#handleLedgerReport" accelerator="Ctrl+9"/>
                    <MenuItem text="ALV-laskelma tileittÃ¤in" onAction="#handleVatReport" accelerator="Ctrl+0"/>
                    <Menu text="Tilikartta">
                        <MenuItem text="Vain kÃ¤ytÃ¶ssÃ¤ olevat tilit" onAction="#handleCoa1"/>
                        <MenuItem text="Vain suosikkitilit" onAction="#handleCoa2"/>
                        <MenuItem text="Kaikki tilit" onAction="#handleCoa0"/>
                    </Menu>
                    <SeparatorMenuItem/>
                    <MenuItem text="Muokkaa" onAction="#handleEditReports"/>
                </Menu>
                
                <!-- TyÃ¶kalut -->
                <Menu text="TyÃ¶kalut">
                    <MenuItem text="ALV-tilien pÃ¤Ã¤ttÃ¤minen" onAction="#handleVatDocument" accelerator="Ctrl+Shift+V"/>
                    <MenuItem text="Ohita vienti ALV-laskelmassa" onAction="#handleSetIgnoreFlag"/>
                    <MenuItem text="Tilien saldojen vertailu" onAction="#handleBalanceComparison"/>
                    <MenuItem text="Muuta tositenumeroita" onAction="#handleNumberShift"/>
                    <MenuItem text="ALV-kantojen muutokset" onAction="#handleVatChange"/>
                    <MenuItem text="Vie tiedostoon" onAction="#handleExport" accelerator="Ctrl+E"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Tuo CSV-tiedostosta..." onAction="#handleCsvImport" accelerator="Ctrl+I"/>
                </Menu>
                
                <!-- Asetukset -->
                <Menu text="Asetukset">
                    <MenuItem text="Yleiset..." onAction="#handleSettings" accelerator="Ctrl+Shift+S"/>
                    <MenuItem text="Ulkoasu..." onAction="#handleAppearance" accelerator="Ctrl+Shift+A"/>
                    <MenuItem text="PikanÃ¤ppÃ¤imet..." onAction="#handleKeyboardShortcuts"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Tulostusasetukset..." onAction="#handlePrintSettings"/>
                    <MenuItem text="Varmuuskopiointi..." onAction="#handleBackupSettings"/>
                    <MenuItem text="Tietokanta..." onAction="#handleDatabaseSettings"/>
                    <SeparatorMenuItem/>
                    <MenuItem text="Vie asetukset..." onAction="#handleExportSettings"/>
                    <MenuItem text="Tuo asetukset..." onAction="#handleImportSettings"/>
                </Menu>
                
                <!-- Ohje -->
                <Menu text="Ohje">
                    <MenuItem text="SisÃ¤ltÃ¶" onAction="#handleHelp" accelerator="F1"/>
                    <MenuItem text="VirheenjÃ¤ljitystietoja" onAction="#handleDebug"/>
                    <MenuItem text="Tietoja ohjelmasta" onAction="#handleAbout"/>
                </Menu>
            </MenuBar>
            
            <!-- Toolbar -->
            <HBox styleClass="tool-bar" spacing="8" alignment="CENTER_LEFT">
                <padding><Insets top="8" right="16" bottom="8" left="16"/></padding>
                
                <!-- Primary actions -->
                <Button fx:id="newDocBtn" text="ï¼‹ Uusi tosite" styleClass="primary" onAction="#handleNewDocument"/>
                <Button fx:id="saveBtn" text="ðŸ’¾ Tallenna" onAction="#handleSave"/>
                
                <Separator orientation="VERTICAL"/>
                
                <!-- Navigation -->
                <Button fx:id="firstBtn" text="&lt;&lt;" styleClass="nav-button" onAction="#handleFirstDocument" minWidth="36">
                    <font><Font size="14" name="System Bold"/></font>
                </Button>
                <Button fx:id="prevBtn" text="&lt;" styleClass="nav-button" onAction="#handlePrevDocument" minWidth="36">
                    <font><Font size="14" name="System Bold"/></font>
                </Button>
                
                <HBox alignment="CENTER" spacing="4">
                    <TextField fx:id="documentNumberField" prefWidth="70" styleClass="doc-number-field" 
                               alignment="CENTER" onAction="#handleGotoDocumentNumber"/>
                    <Label text="/" style="-fx-text-fill: #94a3b8;"/>
                    <Label fx:id="totalDocumentsLabel" text="0" style="-fx-font-weight: 600;"/>
                </HBox>
                
                <Button fx:id="nextBtn" text="&gt;" styleClass="nav-button" onAction="#handleNextDocument" minWidth="36">
                    <font><Font size="14" name="System Bold"/></font>
                </Button>
                <Button fx:id="lastBtn" text="&gt;&gt;" styleClass="nav-button" onAction="#handleLastDocument" minWidth="36">
                    <font><Font size="14" name="System Bold"/></font>
                </Button>
                
                <Separator orientation="VERTICAL"/>
                
                <!-- Search -->
                <TextField fx:id="searchField" prefWidth="200" promptText="ðŸ” Hae tositteita..."/>
                <Button fx:id="searchBtn" text="Hae" onAction="#handleSearch"/>
                
                <!-- Spacer -->
                <Pane HBox.hgrow="ALWAYS"/>
                
                <!-- Period indicator -->
                <Label fx:id="periodIndicator" text="" style="-fx-background-color: #dbeafe; -fx-padding: 6 12; -fx-background-radius: 4; -fx-text-fill: #1e40af; -fx-font-weight: 500;"/>
            </HBox>
        </VBox>
    </top>
    
    <!-- Center: Document content -->
    <center>
        <VBox style="-fx-background-color: #f8f9fa;">
            <padding><Insets top="16" right="20" bottom="16" left="20"/></padding>
            
            <!-- Document header card -->
            <VBox styleClass="card" spacing="16">
                <HBox spacing="24" alignment="CENTER_LEFT">
                    <!-- Document number -->
                    <VBox spacing="4">
                        <Label text="TOSITENUMERO" styleClass="field-label" style="-fx-font-size: 10px; -fx-text-fill: #64748b;"/>
                        <HBox alignment="CENTER_LEFT" spacing="8">
                            <Label fx:id="docNumberDisplay" text="1" style="-fx-font-size: 28px; -fx-font-weight: 700; -fx-text-fill: #1e293b;"/>
                        </HBox>
                    </VBox>
                    
                    <Separator orientation="VERTICAL" prefHeight="50"/>
                    
                    <!-- Date -->
                    <VBox spacing="4">
                        <Label text="PÃ„IVÃ„MÃ„Ã„RÃ„" styleClass="field-label" style="-fx-font-size: 10px; -fx-text-fill: #64748b;"/>
                        <DatePicker fx:id="datePicker" prefWidth="150"/>
                    </VBox>
                    
                    <!-- Document type -->
                    <VBox spacing="4">
                        <Label text="TOSITELAJI" styleClass="field-label" style="-fx-font-size: 10px; -fx-text-fill: #64748b;"/>
                        <ComboBox fx:id="docTypeCombo" prefWidth="220" promptText="Valitse tositelaji"/>
                    </VBox>
                    
                    <!-- Spacer -->
                    <Pane HBox.hgrow="ALWAYS"/>
                    
                    <!-- Document actions -->
                    <VBox spacing="4" alignment="CENTER_RIGHT">
                        <Label text="TOIMINNOT" styleClass="field-label" style="-fx-font-size: 10px; -fx-text-fill: #64748b;"/>
                        <HBox spacing="8">
                            <Button text="ðŸ“Ž Liite" onAction="#handleAttachment"/>
                            <Button text="ðŸ“„ Kopioi" onAction="#handleCopy"/>
                        </HBox>
                    </VBox>
                </HBox>
            </VBox>
            
            <Region prefHeight="16"/>
            
            <!-- Entry table card -->
            <VBox styleClass="card" VBox.vgrow="ALWAYS" spacing="0">
                <padding><Insets top="0" right="0" bottom="0" left="0"/></padding>
                
                <!-- Table header -->
                <HBox style="-fx-background-color: #f8fafc; -fx-padding: 12 16; -fx-border-color: transparent transparent #e2e8f0 transparent;">
                    <Label text="VIENNIT" style="-fx-font-weight: 600; -fx-text-fill: #334155;"/>
                    <Pane HBox.hgrow="ALWAYS"/>
                    <Button text="ï¼‹ LisÃ¤Ã¤ vienti" styleClass="primary" style="-fx-padding: 6 12;" onAction="#handleAddEntry"/>
                </HBox>
                
                <!-- Entry table -->
                <TableView fx:id="entryTable" VBox.vgrow="ALWAYS" style="-fx-border-width: 0;">
                    <columns>
                        <TableColumn fx:id="rowNumCol" text="#" prefWidth="50" sortable="false" style="-fx-alignment: CENTER;"/>
                        <TableColumn fx:id="accountCol" text="Tili" prefWidth="220"/>
                        <TableColumn fx:id="descriptionCol" text="Selite" prefWidth="350"/>
                        <TableColumn fx:id="debitCol" text="Debet â‚¬" prefWidth="130" style="-fx-alignment: CENTER-RIGHT;"/>
                        <TableColumn fx:id="creditCol" text="Kredit â‚¬" prefWidth="130" style="-fx-alignment: CENTER-RIGHT;"/>
                        <TableColumn fx:id="vatCol" text="ALV" prefWidth="80" style="-fx-alignment: CENTER;"/>
                    </columns>
                    <placeholder>
                        <VBox alignment="CENTER" spacing="8">
                            <Label text="ðŸ“‹" style="-fx-font-size: 32px;"/>
                            <Label text="Ei vientejÃ¤" style="-fx-text-fill: #94a3b8; -fx-font-size: 14px;"/>
                            <Label text="LisÃ¤Ã¤ vienti aloittaaksesi" style="-fx-text-fill: #cbd5e1; -fx-font-size: 12px;"/>
                        </VBox>
                    </placeholder>
                </TableView>
                
                <!-- Totals row -->
                <HBox styleClass="totals-row" spacing="32" alignment="CENTER_RIGHT" 
                      style="-fx-background-color: #f8fafc; -fx-padding: 16 20; -fx-border-color: #e2e8f0 transparent transparent transparent;">
                    
                    <HBox spacing="8" alignment="CENTER_RIGHT">
                        <Label text="Debet yhteensÃ¤:" style="-fx-text-fill: #64748b;"/>
                        <Label fx:id="debitTotalLabel" text="0,00" styleClass="total-amount,debit-total"/>
                    </HBox>
                    
                    <HBox spacing="8" alignment="CENTER_RIGHT">
                        <Label text="Kredit yhteensÃ¤:" style="-fx-text-fill: #64748b;"/>
                        <Label fx:id="creditTotalLabel" text="0,00" styleClass="total-amount,credit-total"/>
                    </HBox>
                    
                    <Separator orientation="VERTICAL" prefHeight="24"/>
                    
                    <HBox spacing="8" alignment="CENTER_RIGHT">
                        <Label fx:id="balanceStatusLabel" text="âœ“ Tasapaino" styleClass="balance-ok" style="-fx-font-weight: 600;"/>
                        <Label fx:id="balanceLabel" text="" styleClass="balance-error"/>
                    </HBox>
                </HBox>
            </VBox>
        </VBox>
    </center>
    
    <!-- Bottom: Status bar -->
    <bottom>
        <HBox styleClass="status-bar" spacing="16" alignment="CENTER_LEFT" 
              style="-fx-background-color: #f8fafc; -fx-border-color: #e2e8f0 transparent transparent transparent; -fx-padding: 10 20;">
            
            <Label fx:id="statusLabel" text="Valmis" style="-fx-text-fill: #64748b;"/>
            
            <Pane HBox.hgrow="ALWAYS"/>
            
            <HBox spacing="8" alignment="CENTER_RIGHT">
                <Label text="ðŸ“…" style="-fx-font-size: 12px;"/>
                <Label fx:id="periodLabel" text="Tilikausi: -" styleClass="database-label"/>
            </HBox>
            
            <Separator orientation="VERTICAL" prefHeight="16"/>
            
            <HBox spacing="8" alignment="CENTER_RIGHT">
                <Label text="ðŸ’¾" style="-fx-font-size: 12px;"/>
                <Label fx:id="databaseLabel" text="Ei tietokantaa" styleClass="database-label"/>
            </HBox>
        </HBox>
    </bottom>
    
</BorderPane>
